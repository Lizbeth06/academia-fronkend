<mat-tab-group animationDuration="200ms" class="px-4" [(selectedIndex)]="tabIndex">
  <mat-tab label="Convocatoria" class="tab-content">
    <form [formGroup]="convocatoriaForm" (ngSubmit)="crearConvocatoria()" class="row mt-4">
      <div class="col-12 col-md-4">
        <mat-form-field appearance="outline" class="full-width mat-body">
          <mat-label class="mat-body">Título</mat-label>
          <input matInput formControlName="titulo" placeholder="Ingrese título" />
          <mat-error><ng-container *ngIf="convocatoriaForm.get('titulo')?.hasError('required')">Campo obligatorio</ng-container></mat-error>
        </mat-form-field>
      </div>
      <div class="col-12 col-md-4">
        <mat-form-field appearance="outline" class="full-width mat-body">
          <mat-label class="mat-body">Subtítulo</mat-label>
          <input matInput formControlName="subtitulo" placeholder="Ingrese un subtítulo" />
          <mat-error><ng-container *ngIf="convocatoriaForm.get('subtitulo')?.hasError('required')">Campo obligatorio</ng-container></mat-error>
        </mat-form-field>
      </div>
      <div class="col-12 col-md-4">
        <mat-form-field appearance="outline" class="full-width mat-body">
          <mat-label class="mat-body">Descripción</mat-label>
          <textarea matInput formControlName="descripcion" rows="1" placeholder="Ingrese una descripción"></textarea>
          <mat-error><ng-container *ngIf="convocatoriaForm.get('descripcion')?.hasError('required')">Campo obligatorio</ng-container></mat-error>
        </mat-form-field>
      </div>

      <div class="col-12 col-md-4">
        <mat-form-field appearance="outline" class="full-width mat-body">
          <mat-label class="mat-body">Estado</mat-label>
          <mat-select formControlName="estado" placeholder="Seleccione eestado">
            <mat-option [value]="1">EN CURSO</mat-option>
            <mat-option [value]="0">CERRADO</mat-option>
          </mat-select>
          <mat-error><ng-container *ngIf="convocatoriaForm.get('estado')?.hasError('required')">Campo obligatorio</ng-container></mat-error>
        </mat-form-field>
      </div>
      <div class="col-12 col-md-4">
        <mat-form-field appearance="outline" class="full-width mat-body">
          <mat-label class="mat-body">Modalidad</mat-label>
          <mat-select formControlName="modalidad" placeholder="Seleccione eestado">
            <mat-option [value]="1">DEPORTE</mat-option>
            <mat-option [value]="0">PARADEPORTE</mat-option>
          </mat-select>
          <mat-error><ng-container *ngIf="convocatoriaForm.get('estado')?.hasError('required')">Campo obligatorio</ng-container></mat-error>
        </mat-form-field>
      </div>

      <div class="col-12 col-md-4">
        <mat-form-field appearance="outline" class="full-width mat-body">
          <mat-label class="mat-body">Horario</mat-label>
          <mat-select formControlName="horario" placeholder="Seleccione eestado"> </mat-select>
          <mat-error><ng-container *ngIf="convocatoriaForm.get('estado')?.hasError('required')">Campo obligatorio</ng-container></mat-error>
        </mat-form-field>
      </div>

      <div class="col-12 col-md-12 capa-image">
        <div class="image-container" matTooltip="Subir imagen" matTooltipPosition="above">
          <input class="image-input" type="file" (change)="onImage($event)" #image accept="image/jpeg, image/png" name="image logo" />
          <mat-icon (click)="image.click()" *ngIf="!selectedImage" style="cursor: pointer">add_a_photo</mat-icon>
          <div class="d-flex flex-column gap-2" *ngIf="selectedImage">
            <img [src]="selectedImage" alt="Image convocatoria" style="max-width: 100%; max-height: 700px; margin-top: 8px" />
            <button mat-button color="warn" (click)="removeImage()">Quitar imagen</button>
          </div>
        </div>
      </div>
    </form>
    <div class="mt-4" align="end">
      <button matButton="outlined" color="warn" class="mr-3" (click)="nextTab()">
        <mat-icon>subdirectory_arrow_right</mat-icon>Ir a agregar horarios
      </button>
      <button matButton="filled" color="warn" [disabled]="convocatoriaForm.invalid"><mat-icon>save</mat-icon>Guardar</button>
    </div>
  </mat-tab>

  <!-- Disciplinas y sede -->

  <mat-tab label="Disciplina">
    <form [formGroup]="complejoForm" (ngSubmit)="guardarHorario()" class="row mt-4">
      <div class="col-12 col-md-3">
        <mat-form-field appearance="outline">
          <mat-label>Departamento</mat-label>
          <mat-select formControlName="departamento" placeholder="Departamentos" (selectionChange)="onDepartamentoChange()">
            <mat-option *ngFor="let dep of departamentos" [value]="dep">{{ dep.ubiNombre }}</mat-option>
          </mat-select>
          <mat-error *ngIf="complejoForm.get('departamento')?.hasError('required')">Campo obligatorio </mat-error>
        </mat-form-field>
      </div>
      <div class="col-12 col-md-3">
        <mat-form-field appearance="outline">
          <mat-label>Provincia</mat-label>
          <mat-select formControlName="provincia" placeholder="Provincias" (selectionChange)="onProvinciaChange()">
            <mat-option *ngFor="let prov of provincias" [value]="prov">{{ prov.ubiNombre }}</mat-option>
          </mat-select>
          <mat-error *ngIf="complejoForm.get('provincia')?.hasError('required')">Campo obligatorio </mat-error>
        </mat-form-field>
      </div>

      <div class="col-12 col-md-3">
        <mat-form-field appearance="outline">
          <mat-label>Distrito</mat-label>
          <mat-select formControlName="distrito" placeholder="Distritos" (selectionChange)="onDistritoChange()">
            <mat-option *ngFor="let dist of distritos" [value]="dist">{{ dist.ubiNombre }}</mat-option>
          </mat-select>
          <mat-error *ngIf="complejoForm.get('distrito')?.hasError('required')">Campo obligatorio </mat-error>
        </mat-form-field>
      </div>

      <div class="col-12 col-md-3">
        <mat-form-field appearance="outline">
          <mat-label>Complejo</mat-label>
          <mat-select formControlName="sede" placeholder="Sedes" (selectionChange)="onSedeChange()">
            <mat-option *ngFor="let s of sedes" [value]="s.idSede">{{ s.nombre }}</mat-option>
          </mat-select>
          <mat-error *ngIf="complejoForm.get('sede')?.hasError('required')">Campo obligatorio</mat-error>
        </mat-form-field>
      </div>
    </form>
    <div class="row" style="padding: 0 12px">
      <div class="col-12 col-md-4 seccion-left" align="center">
        <form [formGroup]="disciplinaForm" (ngSubmit)="guardarHorario()">
          <mat-form-field appearance="outline">
            <mat-label>Disciplina</mat-label>
            <mat-select formControlName="nombre">
              <mat-option>Seleccione disciplina</mat-option>
              <mat-option *ngFor="let dis of disciplina" [value]="dis">{{ dis.descripcion }}</mat-option>
            </mat-select>
            <mat-error *ngIf="disciplinaForm.get('nombre')?.hasError('required')"> Campo obligatorio </mat-error>
          </mat-form-field>
        </form>
        <p class="mx-4 my-0">¿Está seguro que desea agregar esta disciplina?</p>
        <button mat-flat-button color="primary" class="loadButton" type="button" (click)="addDisciplina()" [disabled]="disciplinaForm.invalid">
          <mat-icon>save</mat-icon>Agregar
        </button>
      </div>
      <div class="col-12 col-md-8 seccion-right">
        <div class="loader d-flex" *ngIf="loading"></div>
        <div *ngFor="let disciplina of listaDisciplinas" class="card-disciplinas my-3">
          <h3 class="card-title">{{ `Disciplina: ${disciplina.nombreDisciplina}` }}</h3>
          <!-- CONTENIDO -->
          <div class="my-3 px-3">
            <div class="table-horario mat-elevation-z8">
              <table mat-table [dataSource]="disciplina.horarios" class="mat-table-horario">
                <!-- Position Column -->
                <ng-container matColumnDef="id">
                  <th mat-header-cell *matHeaderCellDef>No.</th>
                  <td mat-cell *matCellDef="let row; let idx = index">{{ 1 + idx }}</td>
                </ng-container>

                <!-- Modalidad Column -->
                <ng-container matColumnDef="modalidad">
                  <th mat-header-cell *matHeaderCellDef>Modalidad</th>
                  <td mat-cell *matCellDef="let row">{{ row.categoriaedad.criterioparticipacion.descripcion }}</td>
                </ng-container>

                <!-- Etapa Column -->
                <ng-container matColumnDef="etapa">
                  <th mat-header-cell *matHeaderCellDef>Etapa</th>
                  <td mat-cell *matCellDef="let row">{{ row.categoriaedad.etapa }}</td>
                </ng-container>
                <!-- Categoria Column -->
                <ng-container matColumnDef="categoria">
                  <th mat-header-cell *matHeaderCellDef>Categoria</th>
                  <td mat-cell *matCellDef="let row">{{ row.categoriaedad.descripcion }}</td>
                </ng-container>
                <!-- Edad Column -->
                <ng-container matColumnDef="edad">
                  <th mat-header-cell *matHeaderCellDef>Edad</th>
                  <td mat-cell *matCellDef="let row">{{`${row.categoriaedad.edadminima} a ${row.categoriaedad.edadmaxima} años`}}</td>
                </ng-container>
                <!-- Frecuencia Column -->
                <ng-container matColumnDef="frecuencia">
                  <th mat-header-cell *matHeaderCellDef>frecuencia</th>
                  <td mat-cell *matCellDef="let row">{{ mostrarDiasenhorarios(row.turno.listadia) }}</td>
                </ng-container>
                <!-- Hora Column -->
                <ng-container matColumnDef="hora">
                  <th mat-header-cell *matHeaderCellDef>Hora</th>
                  <td mat-cell *matCellDef="let row">{{`${row.turno.horainicio} a ${row.turno.horafin}`}}</td>
                </ng-container>
                <!-- Estado Column -->
                <ng-container matColumnDef="estado">
                  <th mat-header-cell *matHeaderCellDef>Estado</th>
                  <td mat-cell *matCellDef="let row">
                    <span>
                      {{ row.estado == "1" ? "EN CURSO" : "CERRADO" }}
                    </span>
                  </td>
                </ng-container>
                <!-- Vancantes Column -->
                <ng-container matColumnDef="vacante">
                  <th mat-header-cell *matHeaderCellDef>Vancantes</th>
                  <td mat-cell *matCellDef="let row">{{ row.numVacante }}</td>
                </ng-container>
                <!-- Inscrito Column -->
                <ng-container matColumnDef="inscrito">
                  <th mat-header-cell *matHeaderCellDef>Inscritos</th>
                  <td mat-cell *matCellDef="let row">{{ row.numVacante - row.contador }}</td>
                </ng-container>
                <!-- Acción Column -->
                <ng-container matColumnDef="accion">
                  <th mat-header-cell *matHeaderCellDef>Acciones</th>
                  <td mat-cell *matCellDef="let row">
                    <button mat-icon-button color="primary">
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button color="warn">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="horarioColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: horarioColumns"></tr>
                <tr class="mat-row" *matNoDataRow>
                  <td class="mat-cell text-center" colspan="11">No existe horarios asignados</td>
                </tr>
              </table>
            </div>
          </div>
          <!-- ACCIONES -->
          <div align="end">
            <button mat-button color="primary" (click)="nextTab(disciplina)"><mat-icon>add</mat-icon> Agregar horario</button>

            <button mat-button color="warn" (click)="modalEliminar(validarEliminar, disciplina.idDisciplina)">
              <mat-icon>delete</mat-icon> Eliminar
            </button>
          </div>
        </div>
      </div>
      <div class="mt-4 p-0" align="end">
        <button matButton="outlined" (click)="prevTab($event)"><mat-icon>subdirectory_arrow_left</mat-icon>Ir a convocatorias</button>
      </div>
    </div>
  </mat-tab>

  <!-- HORARIO -->
  <mat-tab label="Horario" [disabled]="tabIndex !== 2">
    <form [formGroup]="horarioForm" (ngSubmit)="guardarHorario()">
      <div class="seccion-superior p-4 row">
        <div class="row">
          <h3 class="fs-6 fw-400 mb-4" align="start">Categoría y temporada</h3>
        </div>
        <div class="col-12 col-md-6">
          <mat-form-field appearance="outline">
            <mat-label>Temporada</mat-label>
            <mat-select formControlName="temporada">
              <mat-option>Seleccione temporada</mat-option>
              <mat-option *ngFor="let tem of temporada" [value]="tem">{{ tem.descripcion }}</mat-option>
            </mat-select>
            <mat-error *ngIf="disciplinaForm.get('nombre')?.hasError('required')"> Campo obligatorio </mat-error>
          </mat-form-field>
        </div>
        <div class="col-12 col-md-6">
          <mat-form-field appearance="outline">
            <mat-label>Categoría</mat-label>
            <mat-select formControlName="categoria">
              <mat-option>Seleccione categoria</mat-option>
              <mat-option *ngFor="let cat of categoria" [value]="cat">{{ cat.descripcion }}</mat-option>
            </mat-select>
            <mat-error *ngIf="disciplinaForm.get('nombre')?.hasError('required')"> Campo obligatorio </mat-error>
          </mat-form-field>
        </div>
      </div>
      <div class="seccion-superior p-4 row">
        <div class="row">
          <h3 class="fs-6 fw-400 mb-4" align="start">Turnos y horas</h3>
        </div>
        <div class="col-12 col-sm-10 col-md-9">
          <mat-form-field appearance="outline">
            <mat-label>Dias y turnos</mat-label>
            <mat-select formControlName="turno" placeholder="Seleccione turno" [(value)]="turnoseleccionado">
              <mat-option>Seleccione turno</mat-option>
              <mat-option class="select-turno" *ngFor="let t of turno" [value]="t" [disabled]="esDeshabilitado(t)">{{ mostrarTurnos(t) }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="col-12 col-sm-2 col-md-3">
          <button mat-raised-button color="secondary" class="w-100" (click)="agregarTurnos($event)" [disabled]="!turnoseleccionado">
            <mat-icon>add</mat-icon>Agregar
          </button>
        </div>
        <div class="col-12 col-sm-12 col-md-12">
          <mat-table [dataSource]="dataTurnos" class="mat-elevation-z8">
            <!-- id Column -->
            <ng-container matColumnDef="id">
              <mat-header-cell *matHeaderCellDef> No. </mat-header-cell>
              <mat-cell *matCellDef="let element; let idx = index"> {{ idx + 1 }} </mat-cell>
            </ng-container>

            <!-- Dias Column -->
            <ng-container matColumnDef="dias">
              <mat-header-cell *matHeaderCellDef> Dias </mat-header-cell>
              <mat-cell *matCellDef="let element"> {{ mostrarDias(element.listadia) }} </mat-cell>
            </ng-container>

            <!-- Hora Column -->
            <ng-container matColumnDef="horas">
              <mat-header-cell *matHeaderCellDef> Horas </mat-header-cell>
              <mat-cell *matCellDef="let element">{{ `${element.horainicio} a ${element.horafin}`}}</mat-cell>
            </ng-container>

            <!-- Accion Column -->
            <ng-container matColumnDef="accion">
              <mat-header-cell *matHeaderCellDef> Acciones </mat-header-cell>
              <mat-cell *matCellDef="let element">
                <div class="d-flex">
                  <button mat-icon-button color="warn" (click)="deleteTurno(element, $event)">
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </mat-cell>
            </ng-container>

            <mat-header-row *matHeaderRowDef="turnosColumns"></mat-header-row>
            <mat-row *matRowDef="let row; columns: turnosColumns"></mat-row>
          </mat-table>
        </div>
      </div>
      <div class="seccion-inferior p-4 row">
        <div class="row">
          <h3 class="fs-6 fw-400 mb-4" align="start">Vacantes</h3>
        </div>
        <div class="col-12 col-md-12">
          <mat-form-field appearance="outline">
            <mat-label>Número vacantes</mat-label>
            <input matInput formControlName="numvacante" placeholder="Ejemplo: 20, 30..." (keydown)="soloNumeros($event, 'numero')" />
            <mat-error *ngIf="horarioForm.get('horainicio')?.hasError('required')"> Campo obligatorio </mat-error>
          </mat-form-field>
        </div>
        <div class="d-flex justify-content-end">
          <button matButton="outlined" color="warn" (click)="prevTab($event)" class="mr-3">
            <mat-icon>close</mat-icon>
            Cancelar
          </button>
          <button mat-flat-button color="primary" class="loadButton" type="submit" [disabled]="horarioForm.invalid || listaTurnos.length === 0">
            <mat-icon>save</mat-icon>Agregar
          </button>
        </div>
      </div>
    </form>
  </mat-tab>
</mat-tab-group>

<ng-template #validarEliminar>
  <div class="title-modal" cdkFocusInitial>¡Importante!</div>
  <div mat-dialog-content align="center">
    <p class="fs-6 fw-400 mb-4">¿Está seguro que desea eliminar esta disciplina?</p>
    <p>Tener en cuenta si elimina se eliminaran todos los horarios agregados</p>
  </div>
  <div mat-dialog-actions align="end" class="footerDialog d-flex">
    <button mat-flat-button color="primary" class="loadButton" type="button" (click)="deleteDisciplina()">SI</button>
    <button type="button" mat-raised-button color="secondary" class="loadButton btnCancelar" mat-dialog-close>Cancelar</button>
  </div>
</ng-template>
