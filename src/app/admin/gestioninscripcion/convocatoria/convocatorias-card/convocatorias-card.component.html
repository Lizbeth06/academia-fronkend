<div class="mb-4" align="end">
  <button matButton="elevated" color="warn" (click)="volverConvocatoria()"><mat-icon>subdirectory_arrow_left</mat-icon>Volver a convocatorias</button>
</div>
<div class="search-filter-section w-100">
  <div class="row">
    <div class="col-12 col-md-8">
      <mat-form-field appearance="outline">
        <mat-label>Buscar convocatorias</mat-label>
        <input matInput [(ngModel)]="busqueda" (ngModelChange)="aplicarFiltros()" placeholder="Título, organización, descripción..." />
        <mat-icon matPrefix>search</mat-icon>
        <button *ngIf="busqueda" mat-icon-button matSuffix (click)="busqueda = ''; aplicarFiltros()">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>
    </div>
    <div class="col-12 col-md-4">
      <button mat-raised-button color="primary" class="btn-filtros w-100" (click)="toggleFiltros()">
        <mat-icon>filter_list</mat-icon>
        {{ mostrarFiltros ? "Ocultar Filtros" : "Mostrar Filtros" }}
      </button>
    </div>
    <ng-container *ngIf="mostrarFiltros">
      <div class="col-12 col-md-3">
        <mat-form-field appearance="outline">
          <mat-label>Región</mat-label>
          <mat-select [(ngModel)]="regionSeleccionada" (ngModelChange)="aplicarFiltros()">
            <mat-option value="">Todas las regiones</mat-option>
            @for (region of regiones; track region) {
            <mat-option [value]="region">
              {{ region }}
            </mat-option>
            }
          </mat-select>
          <mat-icon matPrefix>location_on</mat-icon>
        </mat-form-field>
      </div>

      <div class="col-12 col-md-3">
        <mat-form-field appearance="outline">
          <mat-label>Sede</mat-label>
          <mat-select [(ngModel)]="sedeSeleccionada" (ngModelChange)="aplicarFiltros()">
            <mat-option value="">Todas las sedes</mat-option>
            @for (sede of sedes; track sede) {
            <mat-option [value]="sede">
              {{ sede }}
            </mat-option>
            }
          </mat-select>
          <mat-icon matPrefix>stadium</mat-icon>
        </mat-form-field>
      </div>
      <div class="col-12 col-md-3">
        <!-- Filtro Deporte (NUEVO) -->
        <mat-form-field appearance="outline">
          <mat-label>Deporte</mat-label>
          <mat-select [(ngModel)]="deporteSeleccionado" (ngModelChange)="aplicarFiltros()">
            <mat-option value="">Todos los deportes</mat-option>
            @for (deporte of deportes; track deporte) {
            <mat-option [value]="deporte">
              {{ deporte }}
            </mat-option>
            }
          </mat-select>
          <mat-icon matPrefix>sports_soccer</mat-icon>
        </mat-form-field>
      </div>
      <div class="col-12 col-md-3">
        <!-- Filtro Tipo Convocatoria (NUEVO) -->
        <mat-form-field appearance="outline">
          <mat-label>Tipo Convocatoria</mat-label>
          <mat-select [(ngModel)]="tipoSeleccionado" (ngModelChange)="aplicarFiltros()">
            <mat-option value="">Todos los tipos</mat-option>
            @for (tipo of tiposConvocatoria; track tipo) {
            <mat-option [value]="tipo.idTipoconvocatoria">
              {{ tipo.descripcion }}
            </mat-option>
            }
          </mat-select>
          <mat-icon matPrefix>category</mat-icon>
        </mat-form-field>
      </div>
      <div class="col-12 col-md-12">
        <!-- Botón limpiar -->
        <button mat-raised-button class="btn-limpiar w-100 mb-4" (click)="limpiarFiltros()">
          <mat-icon>clear_all</mat-icon>
          Limpiar Filtros
        </button>
      </div>
    </ng-container>
  </div>
</div>

<div *ngIf="cargando" class="loader-container">
  <mat-spinner diameter="50"></mat-spinner>
  <p>Cargando convocatorias...</p>
</div>

<div class="convocatorias-cards row" *ngIf="!cargando && listaconvocatoriaCard.length > 0">
  <div *ngFor="let conv of listaconvocatoriaCard" class="flip-card-container col-12 col-sm-6 col-md-4 mb-4">
    <div class="flip-card">
      <!-- FRENTE -->
      <div class="flip-card-front">
        <img [src]="conv.convocatoria.urlImagen" [alt]="conv.convocatoria.titulo" class="card-imagen" />
        <div class="card-gradient"></div>

        <div class="card-badges">
          <span class="badge-tipo" [ngClass]="conv.horario.modalidad.idModalidad === 2 ? 'tipo-paradeporte' : 'tipo-deporte'">{{
            conv.horario.modalidad.descripcion
          }}</span>
          <span class="badge-estado" [ngClass]="conv.convocatoria.estado === '1' ? 'estado-activa' : 'estado-cerrada'">
            <mat-icon>{{ conv.convocatoria.estado === "1" ? "check_circle" : "cancel" }}</mat-icon>
            {{ conv.convocatoria.estado === "1" ? "ACTIVA" : "CERRADA" }}
          </span>
        </div>

        <div class="card-front-info">
          <h3>{{ conv.convocatoria.titulo }}</h3>
          <p class="hover-hint">
            <mat-icon>touch_app</mat-icon>
            Ver más detalles
          </p>
        </div>
      </div>

      <!-- REVERSO -->
      <div class="flip-card-back">
        <div class="back-header">
          <span class="back-estado" [ngClass]="conv.convocatoria.estado === '1' ? 'estado-activa' : 'estado-cerrada'">
            <mat-icon>{{ conv.estado === "1" ? "check_circle" : "cancel" }}</mat-icon>
            {{ conv.convocatoria.estado === "1" ? "ACTIVA" : "CERRADA" }}
          </span>
          <span class="back-tipo" [ngClass]="conv.horario.modalidad.idModalidad === 2 ? 'tipo-paradeporte' : 'tipo-deporte'">{{
            conv.horario.modalidad.descripcion
          }}</span>
        </div>
        <div class="back-content">
          <h3>{{ conv.convocatoria.titulo }}</h3>
          <p class="back-subtitle">{{ conv.convocatoria.subtitulo }}</p>

          <div class="back-horarios">
            <div class="horario-item">
              <mat-icon>access_time</mat-icon>
              <div class="horario-data">
                <span class="horario-turno">{{ conv.horario.turno.horafin }}</span>
                <span class="horario-cupos">
                  <mat-icon>groups</mat-icon>
                  {{ conv.horario.numVacante - conv.horario.contador }}/{{ conv.horario.numVacante }}
                </span>
              </div>
            </div>
          </div>

          <!-- BOTÓN DE ACCIÓN -->
          <button type="button" class="btn-inscribirse">
            <mat-icon>how_to_reg</mat-icon>
            <span>Inscribirse Ahora</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="listaconvocatoriaCard.length === 0" class="no-results">
  <mat-icon>search_off</mat-icon>
  <h3>No se encontraron convocatorias</h3>
  <p>Intenta ajustar los filtros de búsqueda</p>
  <!-- <button mat-raised-button color="primary" (click)="limpiarFiltros()">Limpiar filtros</button> -->
</div>
